Type.registerNamespace("dnn.controls");dnn.extend(dnn.controls,{initLabelEdit:function(a){if(a&&dnn.controls.controls[a.id]==null){var b=new dnn.controls.DNNLabelEdit(a);b.initialize();return b}}});dnn.controls.DNNLabelEdit=function(o){dnn.controls.DNNLabelEdit.initializeBase(this,[o]);this.control=this.container;this.editWrapper=null;this.editContainer=null;this.editControl=null;this.prevText="";this.onblurSave=(this.getProp("blursave","1")=="1");this.toolbarId=this.getProp("tbId","");this.nsPrefix=this.getProp("nsPrefix","");this.toolbarEventName=this.getProp("tbEvent","onmousemove");this.toolbar=null;this.css=o.className;this.cssEdit=this.getProp("cssEdit","");this.cssWork=this.getProp("cssWork","");this.cssOver=this.getProp("cssOver","");this.sysImgPath=this.getProp("sysimgpath","");this.callBack=this.getProp("callback","");this.callBackStatFunc=this.getProp("callbackSF","");if(this.callBackStatFunc.length>0){this.add_handler("callBackStatus",eval(this.callBackStatFunc))}this.beforeSaveFunc=this.getProp("beforeSaveF","");if(this.beforeSaveFunc.length>0){this.add_handler("beforeSave",eval(this.beforeSaveFunc))}this.eventName=this.getProp("eventName","onclick");this.multiLineEnabled=this.getProp("multiline","0")=="1";this.saveOnEnter=this.getProp("saveonenter","1")=="1";this.richTextEnabled=this.getProp("richtext","0")=="1";this.supportsCE=(document.body.contentEditable!=null);if(dnn.dom.browser.isType(dnn.dom.browser.Safari)||dnn.dom.browser.isType(dnn.dom.browser.Opera)){this.supportsCE=false}this.supportsRichText=(this.supportsCE||(dnn.dom.browser.isType(dnn.dom.browser.Mozilla)&&navigator.productSub>="20050111"));if(this.eventName!="none"){this.addHandlers(o,this.getDynamicEventObject(this._getEventName(this.eventName),this.performEdit),this)}if(this.toolbarId.length>0){this.addHandlers(o,this.getDynamicEventObject(this._getEventName(this.toolbarEventName),this.showToolBar),this)}this.addHandlers(o,{mousemove:this.mouseMove,mouseout:this.mouseOut},this);this._toolbarActionDelegate=dnn.createDelegate(this,this.toolbarAction);this._initToolbarDelegate=dnn.createDelegate(this,this.initToolbar);this._performEditDelegate=dnn.createDelegate(this,this.performEdit)};dnn.controls.DNNLabelEdit.prototype={isEditMode:function(){return(this.container.style.display!="")},initToolbar:function(){if(this.toolbar==null){var a=dnn.dom.scriptStatus("dnn.controls.dnntoolbar.js");if(a=="complete"){this.toolbar=new dnn.controls.DNNToolBar(this.ns);this.toolbar.loadDefinition(this.toolbarId,this.nsPrefix,this.container,this.container.parentNode,this.container,this._toolbarActionDelegate);this.handleToolbarDisplay()}else{if(a==""){dnn.dom.loadScript(dnn.dom.getScriptPath()+"dnn.controls.dnntoolbar.js","",this._initToolbarDelegate)}}}},toolbarAction:function(a,d){var c=a.clickAction;if(c=="edit"){this.performEdit()}else{if(c=="save"){this.persistEdit();this.toolbar.hide()}else{if(c=="cancel"){this.cancelEdit();this.toolbar.hide()}else{if(this.isFormatButton(c)){if(this.editWrapper){var b;if(c=="createlink"&&dnn.dom.browser.isType(dnn.dom.browser.InternetExplorer)==false){b=prompt(a.tooltip)}this.editWrapper.focus();this.editWrapper.execCommand(c,null,b)}}}}}},performEdit:function(){if(this.toolbar){this.toolbar.hide()}this.initEditWrapper();if(this.editContainer!=null){this.editContainer.style.width="100%";this.editContainer.style.display="";this.editContainer.style.overflow="auto";this.editContainer.style.overflowX="hidden";this.prevText=this.container.innerHTML;if(dnn.dom.browser.isType(dnn.dom.browser.Safari)&&this.container.innerText){this.prevText=this.container.innerText}this.editWrapper.setText(this.prevText);this.initEditControl();this.container.style.display="none";this.handleToolbarDisplay();var a=new Sys.CancelEventArgs();this.invoke_handler("beforeEdit",a);if(a.get_cancel()){this.cancelEdit();return}}},showToolBar:function(){this.initToolbar();if(this.toolbar){this.toolbar.show(false)}},mouseMove:function(a){if(this.toolbarId.length>0&&this.toolbarEventName=="onmousemove"){this.showToolBar()}this.container.className=this.css+" "+this.cssOver},mouseOut:function(){if(this.toolbar){this.toolbar.beginHide()}this.container.className=this.css},initEditWrapper:function(){if(this.editWrapper==null){var e=(this.richTextEnabled&&this.supportsRichText);var c=(e?"dnn.controls.dnnrichtext.js":"dnn.controls.dnninputtext.js");var b=dnn.dom.scriptStatus(c);if(b=="complete"){var a;if(this.richTextEnabled&&this.supportsRichText){var d=dnn.dom.getObjMethRef(this,"initEditControl");a=new dnn.controls.DNNRichText(d)}else{a=new dnn.controls.DNNInputText(this.multiLineEnabled)}this.editWrapper=a;this.editContainer=this.editWrapper.container;this.container.parentNode.insertBefore(this.editContainer,this.container);if(this.richTextEnabled&&this.supportsCE){this.initEditControl()}}else{if(b==""){dnn.dom.loadScript(dnn.dom.getScriptPath()+c,"",this._performEditDelegate)}}}},initEditControl:function(){if(this.editWrapper.initialized){this.editControl=this.editWrapper.control;this.editControl.className=this.container.className+" "+this.cssEdit;this.editWrapper.focus();if(this.editWrapper.loaded==false){var a={keypress:this.handleKeyPress,mousemove:this.mouseMove,mouseout:this.mouseOut};if(this.onblurSave){a.blur=this.persistEdit}if(this.editWrapper.supportsCE||this.editWrapper.isRichText==false){this.addHandlers(this.editControl,a,this)}else{this.addHandlers(this.editContainer.contentWindow.document,a,this)}this.editWrapper.loaded=true}}},persistEdit:function(){if(this.editWrapper.getText()!=this.prevText){if(this.invoke_compatHandler("beforeSave",null,this)){this.editControl.className=this.container.className+" "+this.cssWork;eval(this.callBack.replace("[TEXT]",dnn.escapeForEval(this.editWrapper.getText())))}}else{this.showLabel()}},cancelEdit:function(){this.editWrapper.setText(this.prevText);this.showLabel()},callBackStatus:function(a,b,c){var d=b;d.invoke_compatHandler("callBackStatus",a,b,c)},callBackSuccess:function(a,b,c){b.callBackStatus(a,b);b.invoke_handler("callBackSuccess",new dnn.controls.DNNCallbackEventArgs(a,b,c));b.showLabel();b.flashLabel()},raiseEvent:function(sFunc,evt,element){if(this[sFunc].length>0){var ptr=eval(this[sFunc]);return ptr(evt,element)!=false}return true},handleToolbarDisplay:function(){if(this.toolbar){var c=this.isEditMode();var b;for(var a in this.toolbar.buttons){b=this.toolbar.buttons[a];if(typeof b=="function"){continue}if(a=="edit"){b.visible=!c;if(b.visible){this.toolbar.css=this.toolbar.css.replace(" editMode","")}else{this.toolbar.css=this.toolbar.css+" editMode"}}else{if(this.isFormatButton(a)){b.visible=(c&&this.editWrapper&&this.editWrapper.isRichText)}else{b.visible=c}}}this.toolbar.refresh()}},isFormatButton:function(a){return"~bold~italic~underline~justifyleft~justifycenter~justifyright~insertorderedlist~insertunorderedlist~outdent~indent~createlink~".indexOf("~"+a+"~")>-1},showLabel:function(){this.container.innerHTML=this.editWrapper.getText();this.container.style.display="";this.container.className=this.css;this.editContainer.style.display="none";this.handleToolbarDisplay()},flashLabel:function(){var a=this;this.container.style.backgroundColor="#fffacd";setTimeout(function(){a.container.style.backgroundColor="#fffff0";setTimeout(function(){a.container.style.backgroundColor="transparent"},300)},2500)},callBackFail:function(a,b,c){b.invoke_handler("callBackFail",new dnn.controls.DNNCallbackEventArgs(a,b,c));b.cancelEdit()},handleKeyPress:function(a){if(a.charCode==KEY_RETURN&&this.editWrapper.supportsMultiLine==false){if(this.saveOnEnter){this.persistEdit()}a.preventDefault()}else{if(a.charCode==KEY_ESCAPE){this.cancelEdit();a.preventDefault()}}},dispose:function(){this._toolbarActionDelegate=null;this._initToolbarDelegate=null;this._performEditDelegate=null;dnn.controls.DNNLabelEdit.callBaseMethod(this,"dispose")}};dnn.controls.DNNLabelEdit.registerClass("dnn.controls.DNNLabelEdit",dnn.controls.control);