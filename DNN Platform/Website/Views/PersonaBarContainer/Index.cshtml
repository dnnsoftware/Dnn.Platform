@using DotNetNuke.Web.MvcPipeline
@model Dnn.PersonaBar.UI.Controllers.PersonaBarContainerModel
@{}

<div class="personaBarContainer personalBarContainer">
    <div id="personabar-placeholder" class="personabar-placeholder">
        <!--
            A temporary UI placeholder to avoid the sliding effect when PersonaBar loads
        -->
    </div>
	<iframe id="personaBar-iframe" allowTransparency="true" frameBorder="0" scrolling="false"></iframe>
    <script type="text/javascript" nonce="@Html.CspNonce()" >
        (function($) {
            // Add a class to parent body immediately to indicate PB will be visible
            // This is useful to make room for PB placeholder
            var parentBody = window.parent.document.body;
            var parentBody$ = $(parentBody);
            parentBody$.addClass('personabar-visible');

            $(document.body).ready(function() {
                var w = window,
                    d = document,
                    e = d.documentElement,
                    g = d.getElementsByTagName('body')[0],
                    x = w.innerWidth || e.clientWidth || g.clientWidth,
                    desktopIframe = document.getElementById('personaBar-iframe');

                w["personaBarSettings"] = @Html.Raw(Model.PersonaBarSettings);

                var src = '@(Model.AppPath)/DesktopModules/admin/Dnn.PersonaBar/index.html';
                src += '?cdv=' + '@(Model.BuildNumber)';

                desktopIframe.src = src;

                if (/iPad/i.test(navigator.userAgent)) {
                    $(desktopIframe)
                        .addClass('ipad')
                        .width(x)
                        .wrap('<div class="pb-scroll-wrapper"></div>');
                }
            });
        })(jQuery);
    </script>
</div>
